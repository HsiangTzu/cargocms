var COMMON = {
  DOUBLE_CLICK_TIME_PERIOD: 250,
  DEFAULT_INDEX: -1,
  DEFAULT_AVATAR: "/assets/admin/img/avatars/default.png",
};

var itemBeforeEdit = {};
var prefix = 'admin/';
var modelName = "product";
var appModel = {
  modelName: modelName,
  prefix: prefix,
  data: {
    item: {
      id: '',
      model: '',
      sku: '',
      upc: '',
      ean:'',
      jan:'',
      isbn:'',
      mpn:'',
      location:'',
      quantity:'',
      image:'',
      shipping: true,
      price:'',
      taxRate:'',
      points:'',
      dateAvailable:'',
      weight:'',
      length:'',
      width:'',
      height:'',
      subtract: true,
      minimum:'',
      sortOrder: 0,
      publish:'',
      viewed: 0,
      // SupplierId:'',
      ProductDescription: {},
      Supplier: {},
      Categories:[],
      categoriesId: [],
      categoriesNameArray:[],
      suppliersId: [],
      tax: 0,
      origin: '',
    },
    items: [],
    option: {
      defaultSort: [[ 0, 'desc' ]],
      categoryList: [],
      supplierList: [],
    }
  },
  view: {
    table: {
      selectIndex: COMMON.DEFAULT_INDEX,
    },
  }
}

/* TABLETOOLS */

<%- include ../default/vue.ejs %>
// 需要新增函式可以對 appMain 進行定義，如：
// appMain.log = function () {console.log("123")}
appMain.showPageHidden = function(){
  $('.fn-show-hidden').hide();
};

appMain.calcTax = function() {
  if (appMain.data.item.price && appMain.data.item.taxRate) {
    appMain.data.item.tax = Math.round(Number(appMain.data.item.price) - Number(appMain.data.item.price)/(1 + parseFloat(appMain.data.item.taxRate)))
    return appMain.data.item.tax;
  } else {
    appMain.data.item.tax = 0;
    return appMain.data.item.tax;
  }
}

appMain.addCategory = function (event) {
  var category = $('select[name=categoriesId]').val();
  appMain.data.item.categoriesId = category;
};

appMain.addSupplier = function (event) {
  var supplier = $('select[name=suppliersId]').val();
  appMain.data.item.suppliersId = supplier;
};

appMain.loadCategory = function () {

  $.get('/api/admin/category', ajaxSuccess);

  function ajaxSuccess(result) {
    if (result.success) {
      appModel.data.option.categoryList = result.data.items;
    }
  } // end ajaxSuccess
}

appMain.loadSupplier = function () {

  $.get('/api/admin/supplier', ajaxSuccess);

  function ajaxSuccess(result) {
    if (result.success) {
      appModel.data.option.supplierList = result.data.items;
    }
  } // end ajaxSuccess
}

appMain.enableText = function () {
  $('textarea').attr('disabled', false);
}

appMain.enableSelect = function () {
	$('select').attr('disabled', false);
	$('.select').removeClass('state-disabled');

  // totalRepeat label add disable class
  $(".notForCreate > section:nth-child(1) > label:nth-child(2)").addClass("state-disabled");
  // ScentName label add disabled class
  $("#main-form > fieldset > section:nth-child(2) > label.input").addClass("state-disabled");

  $("input[name=totalRepeat]").attr("disabled", true);
  $("input[name=scentName]").attr("disabled", true);

  $('.onoffswitch-checkbox').attr('disabled', false);

  $('.notForCreate').hide();
}

appMain.setupForm = function (type) {
  var registerForm = $("#main-form");

  if(appModel.data.option.imgUpload){
    var imgUploadSteup = appModel.data.option.imgUpload;
    Object.keys(imgUploadSteup).forEach(function (key) {
       uploadImageApp.updateModel(key, imgUploadSteup[key]);
    });
    uploadImageApp.setup();
  }

  uploadImageApp.updateModel('itemLimit', 1);
  uploadImageApp.updateModel('onComplete', function(id, name, response){
    appMain.data.item.ImageId = response.data.id;
    appMain.data.item.image = response.data.url;
  })
  uploadImageApp.updateModel('onDeleteComplete', function(id, name, response){
    console.log(id, name, response);
    appMain.data.item.ImageId = null;
    appMain.data.item.image = '';
  })
  uploadImageApp.setup();

  registerForm.validate({
    rules: formRules,
    messages: formMessages,
    errorPlacement: function (error, element) {
      error.insertAfter(element.parent());
    },
    submitHandler: function (form) {
      if (type === 'create') {
        appMain.save();
        return false;
      } else if (type === 'edit') {
        appMain.update();
        return false;
      }
    }
  });
}
