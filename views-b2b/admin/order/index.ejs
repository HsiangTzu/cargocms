<style>
.expand {
  width: 15%;
}
.email {
  width: 15%;
}
.telephone {
  width: 8%;
}
.status {
  width: 11%;
}
</style>


<!-- client -->
<table id="main-table" class="table table-striped table-bordered table-hover" width="100%">
	<thead>
		<tr>
      <th width="" data-hide="" data-class="expand"> 
        <i class="fa fa-fw text-muted fa-hashtag"/> 訂單編號</th>
			<th width="" class="" data-hide="always">發票</th>
      <th width="" class="" data-hide="always"> 發票開頭</th>
      <th width="" class="" data-class="" data-hide="phone"> 姓名</th>
      <th width="" data-class="email" data-hide="phone,tablet"> 郵件</th>
      <th width="" data-class="telephone" data-hide="phone"> 電話</th>
      <th width="" class="" data-hide="always"> 傳真</th>
      <!-- <th width="" class="" data-hide="always"> 付款名</th>
      <th width="" class="" data-hide="always"> 付款姓</th>
      <th width="" class="" data-hide="always"> 地址</th>
      <th width="" class="" data-hide="always"> 城市</th>
      <th width="" class="" data-hide="always"> 郵遞區號</th>
      <th width="" class="" data-hide="always"> 付款代碼</th> -->
      <th width="" data-class="paymentMethod" data-hide="phone"> 付款方式</th>
      <th width="" class="" data-hide="always"> 運送名</th>
      <th width="" class="" data-hide="always"> 運送姓</th>
      <th width="" class="" data-hide="always"> 運送郵件</th>
      <th width="" class="" data-hide="always"> 運送電話</th>
      <th width="" class="" data-hide="always"> 運送地址</th>
      <th width="" class="" data-hide="always"> 運送城市</th>
      <th width="" class="" data-hide="always"> 運送郵遞區號</th>
      <th width="" class="" data-hide="always"> 運送方式</th>
      <th width="" class="" data-hide="always"> 運送代碼</th>
      <th width="" class="" data-hide="always"> 貨運單號</th>
      <th width="" class="" data-hide="always"> 附註</th>
      <th width="" class="total" data-hide="always"> 未稅總價</th>
      <th width="" class="tax" data-hide="always"> 稅額</th>
      <th width="" class="totalIncludeTax" data-hide="phone"> 含稅總價</th>
      <!-- <th width="" class=""> 追蹤狀態</th>
      <th width="" class="" data-hide="always"> IP</th>
      <th width="" class="" data-hide="always"> ForwardedIP</th>
      <th width="" class="" data-hide="always"> userAgent</th> -->
      <th width="" class="createdAt" data-hide="always"> 建立時間</th>
      <th width="" class="status" data-class="status" data-hide=""> 訂單狀態</th>
			<th width="120px" class="operate" data-hide="phone,tablet">操作</th>
      <th width="" class="displayName" data-hide="always"> displayName</th>
		</tr>
	</thead>
	<!-- client only -->
	<tbody>
		<tr v-for="item in data.items">
      <td>{{ item.id }}</td>
      <td>{{ item.orderNumber }}</td>
      <td>{{ item.invoiceNo }}</td>
      <td>{{ item.invoicePrefix }}</td>
      <td>{{ item.lastname + item.firstname }}</td>
      <td>{{ item.email }}</td>
      <td>{{ item.telephone }}</td>
      <td>{{ item.fax }}</td>
      <!-- <td>{{ item.paymentFirstname }}</td>
      <td>{{ item.paymentLastname }}</td>
      <td>{{ item.paymentAddress1 }}</td>
      <td>{{ item.paymentCity }}</td>
      <td>{{ item.paymentPostcode }}</td>
      <td>{{ item.paymentCode }}</td> -->
      <td>{{ item.paymentMethod }}</td>
      <td>{{ item.shippingFirstname }}</td>
      <td>{{ item.shippingLastname }}</td>
      <td>{{ item.shippingEmail }}</td>
      <td>{{ item.shippingTelephone }}</td>
      <td>{{ item.shippingAddress1 }}</td>
      <td>{{ item.shippingCity }}</td>
      <td>{{ item.shippingPostcode }}</td>
      <td>{{ item.shippingMethod }}</td>
      <td>{{ item.shippingCode }}</td>
      <td>{{ item.deliveryNumber }}</td>
      <td>{{ item.comment }}</td>
      <td>{{ item.total }}</td>
      <td>{{ item.tax }}</td>
      <td>{{ item.regularNoTaxTotal }}</td>
      <!-- <td>{{ item.tracking }}</td>
      <td>{{ item.ip }}</td>
      <td>{{ item.forwardedIp }}</td>
      <td>{{ item.userAgent }}</td> -->
      <td>{{ item.createdDateTime.dateTime }}</td>
      <td>{{ item.OrderStatus.name }}</td>
			<td align="center" style="cursor: pointer;">
				<div class="row">
					<a class="btn btn-default btn-xs" role="button" v-on:click="show(item.id)">
						<i class="fa-fw fa fa-eye text-muted" />
					</a>
					<a class="btn btn-default btn-xs" role="button" v-on:click="edit(item.id)">
						<i class="fa-fw fa fa-pencil-square-o text-muted"/>
					</a>
				</div>
			</td>
      <td>{{ item.displayName }}</td>
		</tr>
	</tbody>
 </table>


<script type="text/javascript">

  var statusList = <%- JSON.stringify(data.orderStatus) %>;

	var pagefunction = function() {

		// server only
		var columns = [
      { "data": "orderNumber" },
      { "data": "invoiceNo" },
      { "data": "invoicePrefix" },
      { "data": null},
      { "data": "email" },
      { "data": "telephone" },
      { "data": "fax" },
      // { "data": "paymentFirstname" },
      // { "data": "paymentLastname" },
      // { "data": "paymentAddress1" },
      // { "data": "paymentCity" },
      // { "data": "paymentPostcode" },
      { "data": "paymentMethod" },
      // { "data": "paymentCode" },
      { "data": "shippingFirstname" },
      { "data": "shippingLastname" },
      { "data": "shippingEmail" },
      { "data": "shippingTelephone" },
      { "data": "shippingAddress1" },
      { "data": "shippingCity" },
      { "data": "shippingPostcode" },
      { "data": "shippingMethod" },
      { "data": "shippingCode" },
      { "data": "deliveryNumber" },
      { "data": "comment" },
      { "data": "total" },
      { "data": "tax" },
      { "data": "totalIncludeTax" },
      // { "data": "tracking" },
      // { "data": "ip" },
      // { "data": "forwardedIp" },
      // { "data": "userAgent" },
      { "data": "createdAt"},
      { "data": null },
			{ "data": null },
      { "data": "displayName"},
		]

		// server only
		var columnDefs = [
      {
        "targets": 'no-sort',
        "orderable": false,
      },
      {
        "searchable": true,
        "targets": 3,
        "render": function (data, type, row) {
          return '<td>' + row.lastname + row.firstname + '</td>';
        }
      },
      {
        "targets": "total",
        "render": function (data, type, row) {
          return '<td> $' + row.regularTotal + '</td>';
        }
      },
      {
        "targets": "tax",
        "render": function (data, type, row) {
          return '<td> $' + row.regularTax + '</td>';
        }
      },
      {
        "targets": "totalIncludeTax",
        "render": function (data, type, row) {
          return '<td> $' + row.totalIncludeTax + '</td>';
        }
      },
      {
        "searchable": true,
        "targets": "createdAt",
        "render": function (data, type, row) {
          return '<td>' + row.createdDateTime.dateTime + '</td>';
        }
      },
      {
        "searchable": true,
        "targets": "status",
        "render": function (data, type, row) {
          var orderStatus =  row.OrderStatus.name;
          var output = '<select class="form-control input-xs " data-oldValue ="'+ row.OrderStatus.name + '" data-orderId="'+ row.id + '" name="updateStatus">';

          for( var i = 0 ; i < statusList.length; i++) {
            var option = statusList[i];
            output = output + `'<option value="${statusList[i].name }" ${ orderStatus == statusList[i].name ? 'selected' : ''}>${statusList[i].title}</option>'`
          }

          output = output + '<select>';
          return output;
        }
      },
			{
				"targets"  : "operate",
				"orderable": false,
				"searchable": false,
				"render": function ( data, type, row ) {
					var colBody =
					'<div class="row-action-buttons hidden-xs hidden-sm">'+
						'<a name="showDataButton" class="btn btn-default btn-xs" role="button" data-id="'+row.id+'">'+
							'<i class="fa-fw fa fa-eye text-muted" />'+
						'</a>'+
						'<a name="editDataButton" class="btn btn-default btn-xs" role="button" data-id="'+row.id+'">'+
							'<i class="fa-fw fa fa-pencil-square-o text-muted"/>'+
						'</a>'+
            '<a name="orderConfirm" class="btn btn-default btn-xs'+( (data.status === 'NEW') ? "": " hidden ") +'" role="button" data-id="'+ row.id +'" data-total="'+ row.regularTotal +'">'+
              '<i class="fa-fw fa fa-check text-muted"/>'+
            '</a>'+
					'</div>';
					return colBody;
				}
			},
		]
		var serverSidePaging = <%= (data.serverSidePaging != null)?data.serverSidePaging:false %>;
		<%- include vue.ejs %>
		appMain.$mount("#main-index");
    appMain.loadItems(appMain.renderTable);
    appMain.dismissMessageBox();
	};
</script>
